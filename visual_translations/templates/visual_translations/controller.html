{% extends "core/base.html" %}
{% load i18n static %}

{% block theme-css %}
    <link href="{% static "visual_translations/css/knob.css" %}" rel="stylesheet"/>
    <link href="{% static "visual_translations/css/knob-extra.css" %}" rel="stylesheet"/>
{% endblock %}

{% block head-js %}
    {{ block.super }}
    <script src="{% static "visual_translations/js/knob.jquery.js" %}"></script>
{% endblock %}

{% block body-js %}
    <script src="{% static "visual_translations/js/controller.js" %}"></script>
{% endblock %}


{% block body %}

    <section id="main">
        <div id="bars">
            <div id="control"></div>
            {% for word in words %}
                <div class="knobLabel">{{ word }}</div>
            {% endfor %}
        </div>
        <div>
            <button onclick="$.get('http://192.168.255.16:8000/data/v1/visual-translations/broadcast/top-left')">broadcast scroll</button>
        </div>
    </section>

    <script>

    var ws = new WebSocket("{{ WEBSOCKET_URI }}visual-translations-map?subscribe-broadcast&publish-broadcast&echo");
interval = null;

ws.onopen = function() {
    console.log("websocket connected");
    initial = true;
};
ws.onmessage = function(e) {
    if(initial) {
        initial = false;
        return;
    }
    if(interval === null) {
        interval = setInterval(function() { VT.functions.scrollDocument("top-left") }, 100)
    } else {
        clearInterval(interval);
        interval = null;
    }
    console.log("Received: " + e.data);
};
ws.onerror = function(e) {
    console.error(e);
    clearInterval(interval);
    interval = null;
};
ws.onclose = function(e) {
    console.log("connection closed");
    clearInterval(interval);
    interval = null;
};
function send_message(msg) {
    ws.send(msg);
}
{#    $(function(){#}
{#        setTimeout(function(){send_message("hallo?")}, 1000);#}
{#    })#}
    </script>

{% endblock %}